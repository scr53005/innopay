generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model bip39seedandaccount {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique(map: "bip39seedandaccount_userid_key")
  seed        String
  accountName String   @unique(map: "bip39seedandaccount_accountname_key") @db.VarChar(16)
  hivetxid    String?  @unique
  innouser    innouser @relation(fields: [userId], references: [id], map: "bip39seedandaccount_userid_fkey")
}

model innouser {
  id                  Int                   @id @default(autoincrement())
  email               String                @unique
  phoneNumber         String?
  createdAt           DateTime              @default(now())
  verified            Boolean               @default(false)
  bip39seedandaccount bip39seedandaccount?
  topup               topup[]
  bonus               bonus[]
  walletuser          walletuser[]
  email_verification  email_verification[]
}

model topup {
  id         Int      @id @default(autoincrement())
  userId     Int
  amountEuro Decimal  @db.Decimal(65, 2)
  topupAt    DateTime @default(now())
  innouser   innouser @relation(fields: [userId], references: [id], map: "topup_userid_fkey")
}

model walletuser {
  id             Int       @id @default(autoincrement())
  accountName    String    @unique
  creationDate   DateTime  @default(now())
  hivetxid       String    @db.Char(40)
  seed           String?   @db.Text
  masterPassword String?   @db.VarChar(64)
  userId         Int?
  profileName    String?   @db.VarChar(64)
  profileAvatar  String?   @db.VarChar(255)
  profileBckgrd  String?   @db.VarChar(255)
  profileAbout   String?   @db.VarChar(255)
  profileLoc     String?   @db.VarChar(255)
  profileWeb     String?   @db.VarChar(255)
  innouser       innouser? @relation(fields: [userId], references: [id])
  bonus          bonus[]
}

model campaign {
  id           Int       @id @default(autoincrement())
  name         String    @db.VarChar(64)
  startDate    DateTime  @default(now())
  endDate      DateTime?
  minAmount50  Decimal   @db.Decimal(10, 2)
  bonus50      Decimal   @db.Decimal(10, 2)
  maxUsers50   Int
  minAmount100 Decimal   @db.Decimal(10, 2)
  bonus100     Decimal   @db.Decimal(10, 2)
  maxUsers100  Int
  active       Boolean   @default(true)
  bonus        bonus[]
}

model bonus {
  id           Int         @id @default(autoincrement())
  campaignId   Int
  userId       Int?
  walletUserId Int?
  accountName  String      @db.VarChar(16)
  bonusAmount  Decimal     @db.Decimal(10, 2)
  grantedAt    DateTime    @default(now())
  campaign     campaign    @relation(fields: [campaignId], references: [id])
  innouser     innouser?   @relation(fields: [userId], references: [id])
  walletuser   walletuser? @relation(fields: [walletUserId], references: [id])
}

model guestcheckout {
  id              Int       @id @default(autoincrement())
  stripeSessionId String    @unique
  amountEuro      Decimal   @db.Decimal(10, 2)
  amountHbd       Decimal   @db.Decimal(10, 4)
  recipient       String    @db.VarChar(16)
  memo            String    @db.Text
  hiveTxId        String?   @db.Char(40)
  status          String    @db.VarChar(30)
  createdAt       DateTime  @default(now())
  completedAt     DateTime?
}

model currencyConversion {
  id             Int      @id @default(autoincrement())
  date           DateTime @unique
  conversionRate Decimal  @db.Decimal(10, 6)
  createdAt      DateTime @default(now())

  @@map("currency_conversion")
}

model accountCredentialSession {
  id              String   @id @default(cuid())
  accountName     String
  stripeSessionId String   @unique
  masterPassword  String   @db.VarChar(64)
  ownerPrivate    String   @db.Text
  ownerPublic     String   @db.Text
  activePrivate   String   @db.Text
  activePublic    String   @db.Text
  postingPrivate  String   @db.Text
  postingPublic   String   @db.Text
  memoPrivate     String   @db.Text
  memoPublic      String   @db.Text
  euroBalance     Decimal  @db.Decimal(10, 2) @default(0.00)
  email           String?  @db.VarChar(255)
  retrieved       Boolean  @default(false)
  expiresAt       DateTime
  createdAt       DateTime @default(now())

  @@map("account_credential_session")
}

model outstanding_debt {
  id            String    @id @default(cuid())
  created_at    DateTime  @default(now())
  creditor      String    @db.VarChar(16)
  debtor        String    @default("innopay") @db.VarChar(16)
  amount_hbd    Decimal   @default(0) @db.Decimal(10, 3)
  amount_euro   Decimal?  @db.Decimal(10, 2)
  euro_tx_id    String?   @db.Char(40)
  hbd_tx_id     String?   @db.Char(40)
  eur_usd_rate  Decimal   @db.Decimal(10, 4)
  reason        String    @db.VarChar(64)
  paid          Boolean   @default(false)
  paid_at       DateTime?
  payment_tx_id String?   @db.Char(40)
  notes         String?   @db.Text
}

model email_verification {
  id          String    @id @default(cuid())
  user_id     Int
  email       String    @db.VarChar(255)
  code        String    @db.VarChar(6)
  created_at  DateTime  @default(now())
  expires_at  DateTime
  attempts    Int       @default(0)
  verified    Boolean   @default(false)
  verified_at DateTime?
  ip_address  String?   @db.VarChar(45)

  innouser    innouser  @relation(fields: [user_id], references: [id])

  @@index([email, verified])
  @@index([user_id, verified])
}
